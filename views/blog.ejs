<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('partials/head') %>
    <title><%= blog.title %></title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f4f6f8;
        color: #333;
      }

      h1,
      h2 {
        font-weight: 600;
      }

      /* Blog Content */
      .blog-title {
        font-size: 2.2rem;
        color: #2c3e50;
        animation: fadeDown 0.7s ease;
      }

      .blog-body {
        font-size: 1.1rem;
        line-height: 1.6;
        white-space: pre-wrap;
        animation: fadeUp 0.7s ease;
      }

      /* Author Section */
      .author-box {
        display: flex;
        align-items: center;
        margin-top: 20px;
        padding: 10px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        animation: fadeIn 1s ease;
      }

      .author-box img {
        border-radius: 50%;
        margin-right: 12px;
        border: 2px solid #007bff;
      }

      .author-box span {
        font-weight: 600;
        color: #007bff;
      }

      /* Comments Section */
      .comments-section {
        margin-top: 30px;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        animation: fadeIn 1s ease;
      }

      .comment-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #eee;
        transition: transform 0.2s ease;
      }

      .comment-item:hover {
        transform: scale(1.01);
      }

      .comment-item img {
        border-radius: 50%;
        margin-right: 10px;
        border: 1px solid #ddd;
      }

      .comment-content {
        background: #f8f9fa;
        padding: 8px 12px;
        border-radius: 6px;
        width: 100%;
      }

      .comment-author {
        font-weight: bold;
        color: #007bff;
        margin-bottom: 3px;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <%- include('partials/nav') %>

    <!-- Blog Content -->
    <div class="container mt-4">
      <h1 class="blog-title"><%= blog.title %></h1>
      <% if (blog.coverImageURL) { %>
      <img
        src="<%= blog.coverImageURL %>"
        width="100%"
        class="img-fluid rounded mt-3 shadow-sm"
      />
      <% } %>
      <div class="blog-body mt-3"><%= blog.body %></div>
    </div>

    <!-- Author Info -->
    <div class="container author-box mt-4">
      <img
        src="<%= blog.createdBy.profileImageURL %>"
        width="55px"
        height="55px"
      />
      <span><%= blog.createdBy.fullName %></span>
    </div>

    <!-- Comments Section -->
    <div class="container comments-section mt-4">
      <h2>ðŸ’¬ Comments (<%= comments.length %>)</h2>

      <!-- Comment Form (only for logged-in users) -->
      <% if (user) { %>
      <form action="/blog/<%= blog._id %>/comment" method="post" class="mt-3">
        <div class="mb-3 d-flex">
          <input
            type="text"
            name="content"
            class="form-control me-2"
            placeholder="Enter your comment"
            required
          />
          <button class="btn btn-primary" type="submit">Add</button>
        </div>
      </form>
      <% } else { %>
      <p class="text-muted">You must be logged in to add a comment.</p>
      <% } %>

      <!-- Display Comments -->
      <div class="mt-3">
        <% if (comments && comments.length > 0) { %> <%
        comments.forEach((comment) => { %>
        <div class="comment-item">
          <img
            src="<%= comment.createdBy && comment.createdBy.profileImageURL ? comment.createdBy.profileImageURL : '/default-avatar.png' %>"
            width="45px"
            height="45px"
          />
          <div class="comment-content">
            <div class="comment-author">
              <%= comment.createdBy && comment.createdBy.fullName ?
              comment.createdBy.fullName : 'Anonymous' %>
            </div>
            <div><%= comment.content %></div>
          </div>
        </div>
        <% }) %> <% } else { %>
        <p class="text-muted mt-2">No comments yet. Be the first to comment!</p>
        <% } %>
      </div>
    </div>

    <%- include('partials/scripts') %>
  </body>
</html>
